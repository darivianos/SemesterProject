%==========================================================================
%
% Project:  IR control for the Hquad
%
% function: calculate the kalman filter for the z - Axis
%
% Author:   Michael Burri
%
%--------------------------------------------------------------------------
% created:  17.08.2011  v0.1    burrimi 
%==========================================================================


%--------------------------------------------------------------------------
% linearize System
%--------------------------------------------------------------------------
[A_z, B_z, C_z, D_z] = ...
          linmod( 'SimulinkModel_hquad_lin_thrust_0thOrd');
      
[n,m]= size(B_z);
p = size(C_z,1);


%--------------------------------------------------------------------------
% tuning parameters
%--------------------------------------------------------------------------


% % -----------------------------
% % version 1 - optimized for vicon
% % -----------------------------
VERSION_NR = 1;

Q_z = 1*diag([1e-2,1e-1,0.01*ones(1,delay_pade_order)]); % Q kalman
R_z = 1*diag([1e-6,1e-4]);   % R kalman

%--------------------------------------------------------------------------
% kalman estimator discret
%--------------------------------------------------------------------------

[kalm_lqri_z, kalm_lqri_z_ss] = ...
    getKalmanFilterFromContinuous( A_z, B_z, C_z, D_z, Q_z, R_z, Ts);

%==========================================================================
%
% Save the Filter
%
%==========================================================================
PATH_CTRL_z = ['../Hquad_CTRL_OBSV_parameters/obsv_lqri_z_v'...
                    num2str(VERSION_NR) '.mat'];
save(PATH_CTRL_z, 'kalm_lqri_z' , 'kalm_lqri_z_ss');


%==========================================================================
%
% Testing / Run the Simulation
%
%==========================================================================
%
validate_kalman_z

