%==========================================================================
%
% Project:  IR control for the Hquad
%
% function: calculate the kalman filter for the x - Axis
%
% Author:   Michael Burri
%
%--------------------------------------------------------------------------
% created:  17.08.2011  v0.1    burrimi 
%==========================================================================


%--------------------------------------------------------------------------
% linearize System
%--------------------------------------------------------------------------
[A_x, B_x, C_x, D_x] = ...
          linmod( 'SimulinkModel_hquad_lin_pitch_2ndOrd');
      
[n,m]= size(B_x);
p = size(C_x,1);


%--------------------------------------------------------------------------
% tuning parameters
%--------------------------------------------------------------------------


% % -----------------------------
% % version 1 - optimized for vicon
% % -----------------------------
VERSION_NR = 1;

Q_x= 1*diag([1e-2,1e-2,0.01*ones(1,delay_pade_order),1e1,1e4]); % Q kalman
R_x = 1*diag([1e-6,1e-4,1e-5]);   % R kalman


%--------------------------------------------------------------------------
% kalman estimator discret
%--------------------------------------------------------------------------


[kalm_lqri_x, kalm_lqri_x_ss] = ...
    getKalmanFilterFromContinuous( A_x, B_x, C_x, D_x, Q_x, R_x, Ts);

%==========================================================================
%
% Save the Filter
%
%==========================================================================
PATH_CTRL_x = ['../Hquad_CTRL_OBSV_parameters/obsv_lqri_x_v'...
                    num2str(VERSION_NR) '.mat'];
save(PATH_CTRL_x, 'kalm_lqri_x' , 'kalm_lqri_x_ss');


%==========================================================================
%
% Testing / Run the Simulation
%
%==========================================================================
%
% 
validate_kalman_x